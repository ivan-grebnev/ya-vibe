
В прошлом уроке мы сделали лендинг своими руками — без разработчиков и сложной технической подготовки. Теперь сделаем следующий шаг: научим его сохранять заявки пользователей, чтобы с ними можно было работать дальше.

Наша цель — не просто получить отправленную форму, а сохранить контакт так, чтобы он не потерялся и не задублировался.

---

## Разберёмся с полями формы

На форме у нас есть:

* **Имя** — текстовое поле. Пользователь может указать имя, ФИО или даже никнейм.
* **Телефон** — контакт для связи. Это тоже строковое поле.
* **Чекбокс согласия** — нужен для подтверждения перед отправкой формы. Хранить его значение не требуется.

Теперь зададим себе важный вопрос:
что именно делает лид уникальным?

Если ориентироваться на поле «Имя», возникнет проблема. Пользователь может несколько раз отправить форму, меняя написание имени, и система каждый раз будет считать это новым лидом.

А вот номер телефона — гораздо более надёжный ориентир. Именно он должен использоваться как уникальный контакт.

---

## Что важно предусмотреть

Перед сохранением данных нужно учесть два базовых момента:

1. Поля не должны быть пустыми.
2. Один и тот же номер телефона не должен сохраняться несколько раз.

Это позволит избежать хаоса в базе контактов.

---

## Формулируем модель данных

Определим, какие данные мы будем хранить:

* имя — строка, обязательное поле;
* телефон — строка, обязательное и уникальное поле;
* дата создания — чтобы понимать, когда был оставлен контакт (это пригодится для аналитики).

Фактически мы описали структуру одного лида — минимально необходимый набор данных для дальнейшей работы.

---

## Передаём задачу агенту

После того как модель сформулирована, можно попросить агента реализовать сохранение лидов в базе данных.

Техническое задание остаётся без изменений:

```
Ты senior backend-разработчик.

Нужно реализовать сохранение данных с формы лида блока CTA лендинга в базу данных.

Задачи:
- обновить docker-compose: добавить контейнер db с Postgres, добавить volume для хранения данных, настроить переменную окружения DB_URL для app, открыть порт для подключения с локальной сети
- подключить Prisma: добавить зависимости, инициализировать Prisma, настроить подключение к Postgres через DB_URL
- описать модель Lead: id (uuid, primary key, по умолчанию уникальный uuid), name (строка, обязательное), phone (строка, обязательное, уникальное), createdAt (дата создания по умолчанию)
- добавить маршрут POST /api/leads: принимает name и phone, валидирует обязательные поля, сохраняет запись через Prisma, возвращает ошибку при дубликате contact
- обновить frontend: форма отправляет данные на /api/leads, отображает состояние (отправка / успех / ошибка), поле телефон форматируется по правилу - начинается со знака "+" и далее только цифры, форма не отправляться при отжатом чекбоксе согласия
- добавь коммит в git
- перезапусти окружение docker compose
```

---

## Проверяем, как работает форма

После внесения изменений:

1. Перейдите на страницу с формой.
2. Заполните поля и отправьте данные.

Если всё настроено корректно, появится сообщение об успешной отправке.

Теперь проверим логику уникальности:

* отправьте форму ещё раз,
* укажите другое имя,
* но оставьте тот же номер телефона.

В этом случае система должна показать сообщение об ошибке. Это означает, что защита от дубликатов работает правильно.

---

## Проверяем данные в базе

Можно подключиться к базе данных Postgres через любой удобный клиент и открыть таблицу Lead.

<фото таблицы>

В таблице вы увидите сохранённые контакты с именем, телефоном и датой создания.

---

## Автоматизируем тестирование: создаём фейковые лиды

Чтобы не вводить данные вручную во время проверки, можно попросить агента добавить команду для генерации тестовых записей.

Задание остаётся без изменений:

```
Создай команду на генерацию seed 5 рандомных записей в таблице Lead.
Команда должна учитывать уникальность поля phone, соблюдать форматирование значений ("+" и далее цифры).
Добавь информацию в README.md как запустить команду через docker compose.
Проверь, чтобы команда из README.md соответствовала именованию команды в package.json.
Добавь коммит в git.
Перезапусти окружение docker compose.
```

После этого:

1. Запустите команду генерации из README.md.
2. Проверьте таблицу Lead.

В базе должно появиться 5 новых записей.

---

## Главное в этом уроке

* Форма — это не просто элемент интерфейса, а инструмент сбора данных.
* Важно заранее определить, какие поля обязательны и какое из них отвечает за уникальность контакта.
* Проверка на пустые значения и дубликаты — обязательная часть работы с лидами.
* Автоматическая генерация тестовых данных упрощает проверку и экономит время.

Теперь ваш лендинг умеет не только привлекать внимание, но и сохранять контакты для дальнейшей работы.

<проверка знаний>
