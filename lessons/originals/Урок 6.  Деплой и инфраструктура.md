Вот мы и подходим к концу обучающего курса по выполнению тестового задания от Яндекс.Практикум. Осталось финальное действие - запустить наш получившийся проект вживую в глобальной сети!

Для этого нужно выполнить ряд действий:
1) Подготовить проект к публикации
2) Опубликовать репозиторий на GitHub
3) Развернуть проект на VPS
4) Прописать домен в DNS

Подготовимся к публикации:
- все изменения должны быть закоммичены
- переменные окружения задаются через .env файл - создать .env.example
- по одному из условий тестового задания необходимо добавить скрипт быстрой проверки - добавим его
- подготовить проект к работе через защищенное SSL-соединение (HTTPS протокол) - поставим nginx с letsencrypt

По ходу выполнения курсы результаты каждого урока коммитилсь в git, чтобы иметь возможность откатиться и получать атомарные результаты.

Значения env-переменных небезопасно хранить в публичном репозитории - вынесем в .env файл + закроем порты для глобальной сети:

```
Вынеси все переменные окружения задаваемые в docker-compose в файл .env, помести его в ".gitignore". 
Создай на примере .env файл .env.example, внутри которого оставь пустыми значения переменных: WEBHOOK_SECRET, TG_TOKEN, TG_CHAT_ID.
Закрой порты сервисов app и db от глобальной сети
Создай git коммит
Перезапусти окружение
```

Создадим скрипт быстрой проверки проекта. Возможный сценарий использования демо-скрипта:
- скачали репозиторий
- открыли в файле README.md блок про демо-запуск
- выполнили команду демо-запуска

Реализуем:
```
Необходимо реализовать команду демо-запуска проекта - bash-скрипт запуска docker-compose окружения только контейнеров app и db (в detached режиме). У команды есть опция передачи значения TG_TOKEN.

Перед запуском контейнеров .env.example копируется в .env, проставляется demo-значение в переменную WEBHOOK_SECRET

После того как контейнеры запущены и готовы к работе:
- если в команду демо-запуска передавался опционально токен TG_TOKEN тогда получаем TG_CHAT_ID и заполняем переменные в .env
- выполняем команды seed-заполнения таблицы Lead
- проверяем работу событий landing_view, cta_click и lead_created
- проверяем работу webhook все варианты сочетания lead_id и event_id
  
Создай git коммит
```

В итоге, скрипт запускает окружение, лендинг доступен по http://localhost:3000, данные в БД заполняются, если был передан TG_TOKEN (ВАЖНО: бот должен быть запущен и туда должно было отправиться 1 любое сообщение) тогда прийдет уведомление о создании Demo-лида.

Добавим в окружение контейнер nginx с ssl для запуска в глобальной сети:
```
Добавь в docker-compose сервис nginx, который необходим для запуска app-приложения в глобальной сети под https-протоколом.

SSL должен предоставляться сервисом letsencrypt, сертификат выпускается при старте контейнера если еще не был выпущен ранее.

Домен задается переменной окружения SITE_HOST в сервисе nginx.

Переменную SITE_HOST нужно добавить в .env.example

ВАЖНО: домен будет 3-го уровня.
```

Все подготовления окончены, опубликуем проект на Github:
```
git remote add origin git@github.com:ivan-grebnev/ya-vibe.git
git push origin main
```

Развернем проект на VPS (выполним ручной деплой):
```
ssh -p 24422 <user>@<host>
mkdir -p /app
cd /app
git clone https://github.com/ivan-grebnev/ya-vibe.git
cp .env.example .env
nano .env # прописываем: WEBHOOK_SECRET, TG_TOKEN, SITE_HOST
docker compose up -d
```

И наш лендинг работает в глобальной сети:
https://ya-vibe.greb.pro/

<проверка знаний>